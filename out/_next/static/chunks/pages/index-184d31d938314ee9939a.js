(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{60:function(e,n,t){"use strict";t.d(n,{rS:function(){return a},Yu:function(){return s},UO:function(){return i}});var a="\n  mutation GenerateCertificate($name: String!, $password: String!) {\n    generateCertificate(name: $name, password: $password) {\n      certificate {\n        id\n        name\n        is_revoked\n      }\n      p12\n    }\n  }\n",s="\n  mutation RevokeCertificate($id: ID!) {\n    revokeCertificate(id: $id) {\n      ... on NotFoundException {\n        message\n      }\n\n      ... on RevokeCertificateSuccess {\n        success\n      }\n    }\n  }\n",i="\n  query {\n    crl\n  }\n"},9631:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return x}});var a=t(5878),s=t(374),i=t(4651),l=t(7294),r=t(60),u=t(8715),c=t(5073),o=t(1549),d=t(2503),h=t(5893),f=function(e){e.token;var n=e.hasChanges,t=(0,l.useContext)(a.Il).user,s=(0,l.useState)(""),i=s[0],f=s[1],m=(0,l.useState)(""),v=m[0],x=m[1],p=(0,l.useState)(null),g=(p[0],p[1]);return(0,h.jsxs)("div",{className:"flex wrap",children:[(0,h.jsxs)(c.Z,{width:"half-on-large",paddingRight:!0,children:[(0,h.jsx)("h1",{children:"Issue a new certificate"}),(0,h.jsx)("p",{children:"Before you issue a new certificate, please check the user information above and save the changes if necessary."}),(0,h.jsx)("label",{className:"label",children:"Certificate Name"}),(0,h.jsx)("input",{className:"input",type:"text",value:i,onChange:function(e){return f(e.target.value)}}),(0,h.jsx)("label",{className:"label",children:"Certificate Password"}),(0,h.jsx)("input",{className:"input",type:"password",value:v,onChange:function(e){return x(e.target.value)}}),(0,h.jsx)("button",{className:"button",disabled:n||0===i.length,onClick:function(e){if(!n)return(0,o.ZP)(r.rS,{name:i,password:v}).then((function(e){g(e.generateCertificate.certificate);var n=e.generateCertificate.p12,t=document.createElement("a");t.href="data:application/octet-stream;base64,"+n,t.download="".concat(e.generateCertificate.certificate.name,".p12"),t.click(),f(""),x(""),(0,d.JG)(u.PB)}))},children:"Generate certificate"})]}),(0,h.jsxs)(c.Z,{width:"half-on-large",paddingLeft:!0,children:[(0,h.jsx)("h1",{children:"List of issued certificates"}),(0,h.jsxs)("table",{className:"table",children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{children:"ID"}),(0,h.jsx)("th",{children:"Name"}),(0,h.jsx)("th",{children:"Issued at"}),(0,h.jsx)("th",{children:"Revoke(-d)"})]})}),(0,h.jsx)("tbody",{children:t&&t.certificates.map((function(e,n){return(0,h.jsxs)("tr",{children:[(0,h.jsx)("td",{children:e.id}),(0,h.jsx)("td",{children:e.name}),(0,h.jsx)("td",{children:new Date(e.created_at).toLocaleDateString()}),(0,h.jsx)("td",{children:e.is_revoked?"Revoked":(0,h.jsx)("button",{className:"button",onClick:(t=e.id,function(e){return(0,o.ZP)(r.Yu,{id:t}).then((function(e){"success"in e.revokeCertificate&&(0,d.JG)(u.PB)}))}),children:"Revoke"})})]},n);var t}))})]})]})]})},m=function(e){var n=e.user,t=(e.token,e.hasChanges),a=e.setHasChanges,s=(0,l.useState)(null),i=s[0],r=s[1],f=(0,l.useState)(null),m=f[0],v=f[1],x=(0,l.useState)(null===n||void 0===n?void 0:n.firstname),p=x[0],g=x[1],j=(0,l.useState)(null===n||void 0===n?void 0:n.lastname),b=j[0],N=j[1],C=(0,l.useState)(null===n||void 0===n?void 0:n.email),w=C[0],k=C[1];(0,l.useEffect)((function(){var e=null!==i&&""!==i||p!==(null===n||void 0===n?void 0:n.firstname)||b!==(null===n||void 0===n?void 0:n.lastname)||w!==(null===n||void 0===n?void 0:n.email);e!==t&&a(e)}),[n,i,p,b,w]);return(0,l.useEffect)((function(){p||g(null===n||void 0===n?void 0:n.firstname),b||N(null===n||void 0===n?void 0:n.lastname),w||k(null===n||void 0===n?void 0:n.email)}),[n]),n?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("h1",{children:"User information"}),(0,h.jsxs)("div",{className:"flex wrap",children:[(0,h.jsxs)(c.Z,{width:"half-on-large",paddingRight:!0,children:[(0,h.jsx)("label",{className:"label",children:"User ID"}),(0,h.jsx)("input",{className:"input",type:"text",value:n.username||"",readOnly:!0}),(0,h.jsx)("label",{className:"label",children:"Password"}),(0,h.jsx)("input",{className:"input",type:"password",value:i||"",onChange:function(e){return r(e.target.value)}}),(0,h.jsx)("small",{className:"note",children:"Note: If you leave this field empty, the password won't be changed."}),i&&i.length>0&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("label",{className:"label",children:"Old Password"}),(0,h.jsx)("input",{className:"input",type:"password",value:m||"",onChange:function(e){return v(e.target.value)}})]}),(0,h.jsx)("button",{className:"button margin-right",onClick:function(){(0,o.ZP)(u.LK,{firstname:p,lastname:b,email:w}).then((function(e){(0,d.JG)(u.PB,{me:e.updateMe})})),i&&i.length>0&&(0,o.ZP)(u.D3,{oldPassword:m,newPassword:i}).then((function(e){"message"in e.updatePassword||(r(null),v(null))}))},disabled:!t,children:"Save Changes"}),(0,h.jsx)("button",{className:"button",onClick:function(){r(null),g(null===n||void 0===n?void 0:n.firstname),N(null===n||void 0===n?void 0:n.lastname),k(null===n||void 0===n?void 0:n.email)},disabled:!t,children:"Reset"})]}),(0,h.jsxs)(c.Z,{width:"half-on-large",paddingLeft:!0,children:[(0,h.jsx)("label",{className:"label",children:"Firstname"}),(0,h.jsx)("input",{className:"input",type:"text",value:p||"",onChange:function(e){return g(e.target.value)}}),(0,h.jsx)("label",{className:"label",children:"Lastname"}),(0,h.jsx)("input",{className:"input",type:"text",value:b||"",onChange:function(e){return N(e.target.value)}}),(0,h.jsx)("label",{className:"label",children:"E-Mail"}),(0,h.jsx)("input",{className:"input",type:"text",value:w||"",onChange:function(e){return k(e.target.value)}})]})]})]}):null},v=t(2113),x=(0,a.t_)((function(){var e=(0,l.useContext)(a.Il),n=e.user,t=e.token,r=(0,i.useRouter)(),u=(0,s.W)(),c=(0,l.useState)(!1),o=c[0],d=c[1];return(0,l.useEffect)((function(){u||r.push("/login")}),[u]),u&&n?(0,h.jsxs)(v.Z,{children:[(0,h.jsx)(m,{user:n,token:t,hasChanges:o,setHasChanges:d}),(0,h.jsx)("hr",{}),(0,h.jsx)(f,{token:t,hasChanges:o})]}):(JSON.stringify(u),JSON.stringify(n),null)}))},5301:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(9631)}])}},function(e){e.O(0,[119,113,774,888,179],(function(){return n=5301,e(e.s=n);var n}));var n=e.O();_N_E=n}]);